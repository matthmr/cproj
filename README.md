# C Project Template

Template files that might be useful in a C project.

## scripts/

### configure.in

Mock-up of an [autotools](https://en.wikipedia.org/wiki/GNU_Autotools) configure file. It doesn't
actually use the autotools, instead it uses common posix utilities + m4. It is autogenerated using
`mkconfigure.sh`, which in turn fetches data from `configure.m4` to compile the `configure` (shell)
script. In general, you'll be changing the `configure.m4` and regenerating the `configure` script
with `mkconfigure.sh`.

`configure.m4` sets the following shell variables:

- `SET_FLAGS` : double-dashed variables for the `Flags.mk` file. Those variables are written
              all in uppercase in the Makefile, but are passed lowercase in the configure
              script.
- `SET_FLAG_PREFIX` : m4 prefix for the variables.
- `INCLUDE_FLAGS` : one-dashed/plused include variables for the Makefile.
- `INCLUDE_FLAG_PREFIX` : m4 prefix for the variables.
- `CALLEES` : target scripts minus the `.sh` postfix.
- `BUILDS_CALL` : target call command (one per target script).

It is recommended to change the `--help` message after changing any of the variables
as it does not autogenerate. Also, i

### mkconfigure.sh

`configure` generator shell script. Fetches data from `<template>`. Run `./mkconfigure.sh <location of configure.m4> <template> <infile>`
to get the `configure` script. The call syntax is `./mkconfigure.sh <template> <configure>.in`. Notice that
the output file will have the name of the input file minus the `.in` suffix.

### configure.m4

#### Macro functions

- `shell(x)` : set default shell (`sh`)
- `set_flags(x...)` : set the `SET_FLAGS` variable
- `set_flag_prefix(x)` : set the `SET_FLAG_PREFIX` variable (`M4_FLAG`)
- `include_flags(x...)` : set the `INCLUDE_FLAGS` variable
- `include_flag_prefix(x...)` : set the `INCLUDE_FLAG_PREFIX` variable (`M4_INCLUDE`)
- `callees(x...)` : set the `CALLEES` variable
- `builds_call(x...)` : set the `BUILDS_CALL` variable.
Only sets the environment variables to pass to the build scripts. Call one **per** script,
**must** be called for **all** scripts defined in `callees`. Call this function with an
empty quote to not pass any environment variable.
- `genconfig` : generates the config for the file passed in **must** be included
on every m4 template for `configure`

Here's an example of the usage of `mkconfigure` and `configure.m4`:

#### M4 TEMPLATE (template.m4)
```m4
shell(`bash')
set_flags(`cc', `cflags')
callees(`make-flags', `make-deps', `make-makefile')
builds_call(`M4')
builds_call(`CC')
builds_call(`')
genconfig
```

#### MKCONFIGURE.sh
```sh
$ ./mkconfigure ./configure.m4 template.m4 configure.in
```

### make-script.sh

`configure`'s target template. Change the `--help` message and script body.

### targets.m4

Makefile target m4 template for binaries and libraries.
It uses `CC`, `CFLAGS` and `AR`, `ARFLAGS` as `make` variables.

It sets up an `include` interface with the following macros:

#### Target

```m4
target(`target_name')dnl
target_bin(`target_binaries...')dnl
target_obj(`target_objects...')dnl
target_lib(`tagets_libaries...')dnl
target_gen
```

#### Library

```m4
library(`library_name')dnl
library_obj(`libary_objects...`)dnl
library_gen
```

All values the have `...` are comma separated. It is
also assumed that binaries are stored with `bin` prefix
and libraries are stored with `lib` prefix.

### inline.m4

Generic inlined m4 macro substitution for source files.

Macros are prefixed by `M4FLAG_src` and the call to the m4 binary
passes the `M4ARG_file` macro as the filename. Eg:

```sh
m4 -DM4ARG_file=main.c.in inline.m4 > main.c
```

#### Macro functions
- `setall(x,y)` : sets all intances of `x` to `y` for all files.
- `setfor(f,X)` : sets all intances of `x1` to `x2` in the pair `X` for file `f`.
- `unsetfor(f,X)` : unsets all intances of `x` in the list `X` for file `f`.

### Makefile.in

`configure`'s target Makefile.

## src/include

### cli.h

ANSI escape sequence function-like macro definitions. The name of the macros are self-explanatory,
so no documentation will be written.

---

For directories with C sources under `src/`, documentation will be available inside their directories.
